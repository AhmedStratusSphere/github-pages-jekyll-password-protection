<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Home</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>


</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>


<div class="top-nav">
    <div class="inner">
        <img src="logo.jpeg" style="width: 3%">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">


        </div>
        <div class="menu">

            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>



            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >

            <nav>

                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-ss_cs_clear_pdf_group_line.html">ss_cs_clear_pdf_group_line</a></li><li><a href="module-ss_ue_commission_calc_line_item.html">ss_ue_commission_calc_line_item</a></li></ul></div>

            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p></p>
                    <h1>Home</h1>
                </header>







    <h3> </h3>















    <section>
        <article><h1>Commission and DMF Line Item Management Script</h1>
<h2>Description</h2>
<p>This script manages the addition of commission and DMF (Dealer Marketing Fund) line items in NetSuite records. It automatically updates these line items based on specific conditions and parameters.</p>
<h2>Details</h2>
<ul>
<li><strong>API Version:</strong> 2.x</li>
<li><strong>Script Type:</strong> UserEventScript</li>
<li><strong>Title:</strong> Commission and DMF Line Item Management Script</li>
</ul>
<h3>Requirements</h3>
<p>The script requires the following NetSuite modules:</p>
<ul>
<li><code>N/runtime</code></li>
<li><code>N/log</code></li>
</ul>
<h2>Functionality</h2>
<h3>Main Function: <code>beforeSubmit</code></h3>
<p>The <code>beforeSubmit</code> function is triggered before a record is submitted. It performs the following tasks:</p>
<ol>
<li>Retrieves the new record and its line items.</li>
<li>Calculates the commission and DMF amounts based on media budget and billing type.</li>
<li>Updates line items with the calculated commission and DMF amounts.</li>
<li>Sets PDF group numbers for these line items.</li>
<li>Adjusts line items based on specific conditions.</li>
</ol>
<h3>Key Sub-functions</h3>
<h4><code>UpdateOriginalLineItem</code></h4>
<p>Updates the original line item with the specified value and group number.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>currentRecord</code>: The current NetSuite record being processed.</li>
<li><code>sublistName</code>: The name of the sublist being modified.</li>
<li><code>lineindex</code>: The line index to update.</li>
<li><code>value</code>: The value to set for the line item.</li>
<li><code>groupNumber</code>: The group number to assign to the line item.</li>
</ul>
<p><strong>Returns:</strong> The set PDF group number value.</p>
<h4><code>addCommissionLineItem</code></h4>
<p>Adds or updates a commission/DMF line item in the transaction record.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>currentRecord</code>: The current NetSuite record being processed.</li>
<li><code>sublistName</code>: The name of the sublist being modified.</li>
<li><code>mediaCommissionItem</code>: The ID of the media commission item.</li>
<li><code>commissionAmount</code>: The amount of commission to apply.</li>
<li><code>currentItemValue</code>: The current item's value object.</li>
<li><code>pdfGroupNumberInitValue</code>: The initial value of the PDF group number.</li>
</ul>
<h4><code>calculateCommission</code></h4>
<p>Calculates the commission amount based on media budget and commission rate.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>mediaBudget</code>: The media budget amount.</li>
<li><code>bodymediaCommission</code>: The body media commission rate.</li>
<li><code>isPostBill</code>: Flag indicating if it is post-bill.</li>
<li><code>hasDmf</code>: Indicates if the item has DMF.</li>
</ul>
<p><strong>Returns:</strong> The calculated commission amount.</p>
<h4><code>calculateDmf</code></h4>
<p>Calculates the DMF amount based on media budget and commission rate.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>mediaBudget</code>: The media budget amount.</li>
<li><code>bodymediaCommission</code>: The body media commission rate.</li>
<li><code>isPostBill</code>: Flag indicating if it is post-bill.</li>
</ul>
<p><strong>Returns:</strong> The calculated DMF amount.</p>
<h4><code>calculatePrebill</code></h4>
<p>Calculates the prebill amount.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>mediaBudget</code>: The media budget amount.</li>
<li><code>bodymediacommission</code>: The body media commission rate.</li>
<li><code>x</code>: Additional multiplier or parameter.</li>
</ul>
<p><strong>Returns:</strong> The calculated prebill amount.</p>
<h4><code>getLineItemValue</code></h4>
<p>Retrieves line item values from a given record and line index.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>newRecord</code>: The NetSuite record object.</li>
<li><code>sublistId</code>: The ID of the sublist.</li>
<li><code>line</code>: The line number to retrieve values from.</li>
</ul>
<p><strong>Returns:</strong> An object containing line item values.</p>
<h4><code>extractItemDetail</code></h4>
<p>Extracts item details from a given line item value object.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>currentItemValue</code>: The current line item value object.</li>
<li><code>runtime</code>: The runtime object for getting script parameters.</li>
</ul>
<p><strong>Returns:</strong> An object containing extracted item details.</p>
<h2>Error Handling</h2>
<p>The script includes a try-catch block to handle any errors that occur during execution. Errors are logged using <code>log.error</code>.</p>
<h2>Usage</h2>
<ol>
<li>Deploy this script as a User Event Script in NetSuite.</li>
<li>Ensure the necessary custom fields (<code>custbody_moore_media_commission</code>, <code>custbody_moore_media_billing_type</code>, etc.) are present in the records.</li>
<li>Configure the script parameters (<code>custscript_ss_media_commission_item_para</code>, <code>custscript_ss_dmf_item_para</code>) as required.</li>
</ol>
<h2>Notes</h2>
<ul>
<li>The script relies on specific field IDs and custom fields in NetSuite. Ensure these fields are correctly set up in your environment.</li>
<li>Adjust the script parameters as needed to match your specific use case.</li>
</ul>
<h2>Client Script for Line Copy</h2>
<p>To prevent conflicts when users copy line items, there is an associated client script. This script clears the PDF group field on the new line to avoid issues and to save the user from manually clearing it each time.</p>
<pre class="prettyprint source lang-javascript"><code>/**
 * @NApiVersion 2.x
 * @NScriptType ClientScript
 */
define(['N/record', 'N/currentRecord', 'N/log'], function(record, currentRecord, log) {

    function pageInit(context) {
        var makeCopyButton = document.getElementById('item_copy');
        if (makeCopyButton) {
            makeCopyButton.onclick = function() {
                try {
                    // Perform the line copy
                    item_machine.copyline();

                    setWindowChanged(window, true);

                    var rec = currentRecord.get();

                    var sublistId = 'item';

                    var currentLine = rec.getCurrentSublistIndex({
                        sublistId: sublistId
                    });

                    // Clear the 'custcol_pdf_group' field on the new line
                    rec.setCurrentSublistValue({
                        sublistId: sublistId,
                        fieldId: 'custcol_ss_pdf_group',
                        value: ''
                    });

                    console.log('line copied')

                    return false;
                } catch (e) {
                    console.error('Error in Make Copy Click Handler', e.message);
                    return false;
                }
            };
        }
    }

    return {
        pageInit: pageInit
    };
});

</code></pre></article>
    </section>






            </div>

            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a></p>
                    <p class="sidebar-created-by">
                    </p>
                </div>
            </footer>

        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
